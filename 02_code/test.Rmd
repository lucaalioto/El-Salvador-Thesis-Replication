---
title: "Theming with bslib and thematic"
output: 
  html_document:
    code_folding: show
    theme:
      bg: "#202123"
      fg: "#B8BCC2"
      primary: "#EA80FC"
      secondary: "#00DAC6"
      base_font:
        google: Prompt
      heading_font:
        google: Proza Libre
---

```{r setup, include=FALSE}
if (requireNamespace("thematic")) 
  thematic::thematic_rmd(font = "auto")
```

## R Markdown

This is an R Markdown document themed with [`{bslib}` package](https://rstudio.github.io/bslib/). `{bslib}` makes it easy to customize the main colors and fonts of a `html_document`, [`flexdashboard::flex_dashboard`](https://flexdashboard-pkg.netlify.app/articles/articles/theme.html), [shiny::fluidPage()](https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html), or more generally any website that uses [Bootstrap](https://getbootstrap.com/) for styling. The `theme` parameter in the yaml front-matter of this Rmd document describes a [`bslib::bs_theme()`](https://rstudio.github.io/bslib/reference/bs_theme.html) object, which provides access to 100s of [theming options](https://rstudio.github.io/bslib/articles/bs5-variables.html) (via its `...` argument) in addition to the main options demonstrated here (e.g., `bg`, `fg`, `primary`, etc).

This particular example uses `{bslib}`'s default [Bootstrap version (which, at the time of writing, is Bootstrap 5)](https://rstudio.github.io/bslib/articles/bslib.html#versions). However, if reproducibility is important, it's recommended that you "lock-in" the version by adding `version: 5` to the `theme` definition.

## Themed Plots {.tabset .tabset-pills}

When running this document with [`{thematic}`](https://rstudio.github.io/thematic/) installed, the `thematic::thematic_rmd(font = "auto")` effectively translates `theme` (CSS) settings to new global theming defaults for `{ggplot2}`, `{lattice}`, and `{base}` R graphics:

### ggplot2

```{r}
library(ggplot2)
library(dplyr)
library(here)
library(scales)
library(tidyverse)
library(haven)

LAPOP23 = haven::read_dta(here("01_data/02_lapop/SLV_2023_LAPOP_AmericasBarometer_v1.0_w.dta"))


LAPOP23 = LAPOP23 %>%
  filter(!vb3n %in%  c(888888, 988888, 999999)) %>%
  mutate(voted_bukele = ifelse(vb3n == 1, 1, 0),
         vote_2019 = case_when(
           vb3n == 00 ~ "Left Blank",
           vb3n == 97 ~ "Annulled",
           vb3n == 301 ~ "Nayib Bukele",
           vb3n == 302 ~ "Carlos Calleja - ARENA",
           vb3n == 303 ~ "Hugo Martínez - FMLN",
           vb3n == 304 ~ "Josué Alvarado - VAMOS",
           vb3n == 307 ~ "Other Candidate",
           TRUE ~ NA_character_
         ))

# See the distribution by percentage


vote_summary <- LAPOP23 |>
  filter(!is.na(vote_2019)) |>
  count(vote_2019, name = "n") |>
  mutate(pct = n / sum(n))

vote_summary |>
  ggplot(aes(x = reorder(vote_2019, -pct), y = pct)) +
  geom_col(fill = "steelblue") +
  geom_text(
    aes(label = paste0("n = ", n)),
    vjust = -0.4,
    size = 3
  ) +
  scale_y_continuous(labels = percent_format(), expand = expansion(mult = c(0, 0.1))) +
  labs(
    title = "2019 Presidential Election Vote Choice",
    x = "Candidate",
    y = "Percent of respondents"
  ) +
  theme_classic()
```

### lattice

```{r}
lattice::show.settings()
```

### base

```{r}
plot(pressure, col = thematic::thematic_get_option("accent"))
```
